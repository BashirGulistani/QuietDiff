<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>QuietDiff Report</title>
    <style>
      :root { --bg:#0b0b0d; --card:#121218; --muted:#a7a7b3; --text:#f2f2f5; --line:rgba(255,255,255,.10); --pill:#1c1c26; }
      body { margin:0; font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial; background: radial-gradient(1200px 700px at 15% 10%, rgba(255,255,255,.08), transparent 55%), var(--bg); color:var(--text); }
      .wrap { max-width: 1120px; margin: 0 auto; padding: 22px 18px 48px; }
      .top { display:flex; justify-content:space-between; gap: 14px; align-items:flex-start; flex-wrap:wrap; }
      h1 { margin:0; font-size: 20px; letter-spacing: -0.02em; }
      .sub { color: var(--muted); font-size: 13px; margin-top: 6px; line-height:1.35; }
      .grid { display:grid; grid-template-columns: repeat(5, minmax(0,1fr)); gap: 10px; margin-top: 14px; }
      .card { background: rgba(255,255,255,.04); border: 1px solid var(--line); border-radius: 14px; padding: 12px 12px; }
      .k { color: var(--muted); font-size: 12px; }
      .v { font-size: 18px; font-weight: 800; margin-top: 4px; letter-spacing: -0.02em; }
      .tools { margin-top: 14px; display:flex; gap: 10px; flex-wrap:wrap; }
      .in { flex: 1; min-width: 240px; background: rgba(255,255,255,.04); border: 1px solid var(--line); border-radius: 12px; padding: 10px 12px; color: var(--text); outline: none; }
      .pill { background: var(--pill); border: 1px solid var(--line); color: var(--text); border-radius: 999px; padding: 8px 10px; font-size: 13px; cursor:pointer; }
      .pill[data-on="1"] { background: rgba(255,255,255,.10); }
      table { width: 100%; border-collapse: collapse; margin-top: 14px; background: rgba(255,255,255,.03); border: 1px solid var(--line); border-radius: 14px; overflow:hidden; }
      th, td { padding: 10px 10px; border-bottom: 1px solid var(--line); font-size: 13px; vertical-align: top; }
      th { text-align:left; font-size: 12px; color: var(--muted); letter-spacing: .06em; text-transform: uppercase; }
      tr:hover td { background: rgba(255,255,255,.03); }
      .type { display:inline-flex; align-items:center; gap:8px; }
      .dot { width: 9px; height: 9px; border-radius: 999px; background: rgba(255,255,255,.35); }
      .dot.added { background: #4ade80; }
      .dot.removed { background: #fb7185; }
      .dot.changed { background: #60a5fa; }
      .muted { color: var(--muted); }
      .mono { font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace; }
      .foot { margin-top: 18px; color: var(--muted); font-size: 12px; }
      .dup { margin-top: 10px; padding: 12px; border: 1px solid var(--line); border-radius: 14px; background: rgba(255,255,255,.03); }
      .dup h3 { margin: 0; font-size: 13px; color: var(--muted); letter-spacing: .06em; text-transform: uppercase; }
      .dup pre { margin: 10px 0 0; white-space: pre-wrap; word-break: break-word; color: var(--text); }
      @media (max-width: 920px) { .grid { grid-template-columns: repeat(2, minmax(0,1fr)); } }
    </style>
  </head>


    <body>
    <div class="wrap">
      <div class="top">
        <div>
          <h1>QuietDiff Report</h1>
          <div class="sub" id="meta"></div>
        </div>
      </div>

      <div class="grid" id="cards"></div>

      <div class="tools">
        <input class="in" id="q" placeholder="Search key / column / old / new..." />
        <button class="pill" id="f_added" data-on="1">Added</button>
        <button class="pill" id="f_removed" data-on="1">Removed</button>
        <button class="pill" id="f_changed" data-on="1">Changed</button>
      </div>

      <table>
        <thead>
          <tr>
            <th style="width: 130px;">Type</th>
            <th>Key</th>
            <th style="width: 180px;">Column</th>
            <th>Old</th>
            <th>New</th>
          </tr>
        </thead>
        <tbody id="tbody"></tbody>
      </table>

      <div class="dup" id="dupbox" style="display:none;"></div>
      <div class="foot">Tip: open this file and share it as-is. No server needed.</div>
    </div>
    <script>
      const DATA = {{__DATA__}};
      const meta = DATA.meta;
      const rows = DATA.rows;

      const elMeta = document.getElementById("meta");
      const elCards = document.getElementById("cards");
      const elBody = document.getElementById("tbody");
      const elQ = document.getElementById("q");

      const fAdded = document.getElementById("f_added");
      const fRemoved = document.getElementById("f_removed");
      const fChanged = document.getElementById("f_changed");

      const dupbox = document.getElementById("dupbox");

      elMeta.textContent = `${meta.left}  →  ${meta.right}   •   keys: ${meta.keys.join(", ")}`;

      const cards = [
        ["Added", meta.counts.added],
        ["Removed", meta.counts.removed],
        ["Changed", meta.counts.changed],
        ["Dup Keys (left)", meta.counts.duplicates_left],
        ["Dup Keys (right)", meta.counts.duplicates_right],
      ];

      elCards.innerHTML = cards.map(([k,v]) => `
        <div class="card">
          <div class="k">${k}</div>
          <div class="v">${v}</div>
        </div>
      `).join("");
      function pillToggle(btn){
        btn.dataset.on = btn.dataset.on === "1" ? "0" : "1";
      }

      fAdded.onclick = () => { pillToggle(fAdded); render(); };
      fRemoved.onclick = () => { pillToggle(fRemoved); render(); };
      fChanged.onclick = () => { pillToggle(fChanged); render(); };

      function onType(type){
        if(type === "added") return fAdded.dataset.on === "1";
        if(type === "removed") return fRemoved.dataset.on === "1";
        return fChanged.dataset.on === "1";
      }

      function rowText(r){
        return `${r.type} ${r.key} ${r.column} ${r.old} ${r.new}`.toLowerCase();
      }

      function render(){
        const q = (elQ.value || "").trim().toLowerCase();
        const filtered = rows.filter(r => {
          if(!onType(r.type)) return false;
          if(!q) return true;
          return rowText(r).includes(q);
        });

        elBody.innerHTML = filtered.map(r => `
          <tr>
            <td>
              <span class="type">
                <span class="dot ${r.type}"></span>
                <span>${r.type}</span>
              </span>
            </td>
            <td class="mono">${escapeHtml(r.key)}</td>
            <td class="mono">${escapeHtml(r.column || "")}</td>
            <td class="mono muted">${escapeHtml(r.old || "")}</td>
            <td class="mono">${escapeHtml(r.new || "")}</td>
          </tr>
        `).join("");





